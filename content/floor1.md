---
title: çˆ¬æ¥¼æ¢¯ä¸ºä½•å¯¹åº” F_{n+1}ï¼Ÿâ€”â€” æ–æ³¢é‚£å¥‘åç§»å…³ç³»çš„å®Œæ•´æ¨å¯¼
date: 2026-01-28
description: ä»é€’æ¨å»ºæ¨¡å‡ºå‘ï¼Œå˜æ¸…çˆ¬æ¥¼æ¢¯é—®é¢˜ä¸æ–æ³¢é‚£å¥‘æ•°åˆ—çš„åç§»å…³ç³»ï¼Œåˆ†æ DPã€è®°å¿†åŒ–æœç´¢çš„é€‚ç”¨è¾¹ç•Œï¼Œå¹¶å¼•å‡ºé«˜ç²¾åº¦åœºæ™¯ä¸‹çš„ç®—æ³•æŒ‘æˆ˜ã€‚
---
---

# ğŸ§—â€â™‚ï¸ çˆ¬æ¥¼æ¢¯é—®é¢˜å…¨è§£æï¼ˆä¸Šï¼‰ï¼šä» DP åˆ° Fast Doubling åŸç†

> **é¢˜ç›®**ï¼šæ¥¼æ¢¯æœ‰ $ N $ é˜¶ï¼Œæ¯æ¬¡å¯ä»¥ä¸Š 1 é˜¶æˆ– 2 é˜¶ã€‚é—®å…±æœ‰å¤šå°‘ç§ä¸åŒçš„èµ°æ³•ï¼Ÿ  

https://www.luogu.com.cn/problem/P1255

> **è¾“å…¥**ï¼šä¸€ä¸ªæ•´æ•° $ N $ï¼ˆ$ 1 \leq N \leq 5000 $ï¼‰  
> **è¾“å‡º**ï¼šèµ°æ³•æ€»æ•°ï¼ˆå®Œæ•´åè¿›åˆ¶æ•°ï¼‰

è¿™é“çœ‹ä¼¼ç®€å•çš„é¢˜ï¼ŒèƒŒåå´è—ç€**åŠ¨æ€è§„åˆ’ã€é€’å½’ä¼˜åŒ–ã€çŸ©é˜µä»£æ•°ã€åˆ†æ²»ç®—æ³•**ç­‰å¤šä¸ªå±‚æ¬¡çš„è§£æ³•ã€‚æœ¬æ–‡å°†å¸¦ä½ ä»åŸºç¡€åˆ°è¿›é˜¶ï¼Œå½»åº•æŒæ¡å®ƒçš„æ‰€æœ‰ä¸»æµè§£æ³•ã€‚

---

## ğŸ”¢ ä¸€ã€é—®é¢˜æœ¬è´¨ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—

è®¾ $ f(n) $ è¡¨ç¤ºèµ°åˆ°ç¬¬ $ n $ é˜¶çš„æ–¹æ³•æ•°ã€‚  
è€ƒè™‘æœ€åä¸€æ­¥ï¼š
- ä» $ n-1 $ èµ° 1 æ­¥ â†’ $ f(n-1) $ ç§
- ä» $ n-2 $ èµ° 2 æ­¥ â†’ $ f(n-2) $ ç§

å› æ­¤ï¼š
$$
f(n) = f(n-1) + f(n-2)
$$
åˆå§‹æ¡ä»¶ï¼š$ f(0) = 1 $, $ f(1) = 1 $

è¿™å°±æ˜¯**æ–æ³¢é‚£å¥‘æ•°åˆ—åç§»ä¸€ä½**ï¼š$ f(n) = F_{n+1} $ï¼Œå…¶ä¸­ $ F_0=0, F_1=1 $ã€‚

> âš ï¸ æ³¨æ„ï¼šå½“ $ N = 5000 $ æ—¶ï¼Œç»“æœä½æ•°ä¼šéå¸¸å¤šï¼Œå¿…é¡»ä½¿ç”¨**é«˜ç²¾åº¦è®¡ç®—**ï¼

---

## ğŸ› ï¸ äºŒã€è§£æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’ï¼ˆDPï¼Œè‡ªåº•å‘ä¸Šï¼‰

### âœ… æ€è·¯
ä»å°åˆ°å¤§è®¡ç®—æ¯ä¸ª $ f(i) $ï¼Œåˆ©ç”¨å·²çŸ¥çš„ $ f(i-1) $ å’Œ $ f(i-2) $ã€‚

### ğŸ’» ä»£ç ï¼ˆC++ï¼Œé«˜ç²¾åº¦ï¼‰
```cpp
#include <iostream>
#include <vector>
using namespace std;

// é«˜ç²¾åº¦åŠ æ³•ï¼šä½ä½åœ¨å‰
vector<int> add(const vector<int>& a, const vector<int>& b) {
    vector<int> res;
    int carry = 0;
    for (int i = 0; i < max(a.size(), b.size()) || carry; ++i) {
        int sum = carry;
        if (i < a.size()) sum += a[i];
        if (i < b.size()) sum += b[i];
        res.push_back(sum % 10);
        carry = sum / 10;
    }
    return res;
}

int main() {
    int n;
    cin >> n;
    vector<vector<int>> dp(n + 1);
    dp[0] = {1};
    if (n >= 1) dp[1] = {1};

    for (int i = 2; i <= n; ++i)
        dp[i] = add(dp[i - 1], dp[i - 2]);

    // è¾“å‡ºï¼ˆé«˜ä½åœ¨åï¼‰
    auto& ans = dp[n];
    for (int i = ans.size() - 1; i >= 0; --i)
        cout << ans[i];
    cout << endl;
}
```

### â±ï¸ å¤æ‚åº¦
- æ—¶é—´ï¼š$ O(N \cdot L) $ï¼Œ$ L $ æ˜¯æ•°å­—ä½æ•°
- ç©ºé—´ï¼š$ O(N \cdot L) $ï¼ˆå¯ä¼˜åŒ–ä¸º $ O(L) $,åªä¾èµ–å‰ä¸¤ä¸ªçŠ¶æ€ï¼‰

âœ… **ä¼˜ç‚¹**ï¼šæ— é€’å½’ã€ç¨³å®šé«˜æ•ˆã€‚

---

## ğŸ§  ä¸‰ã€è§£æ³•äºŒï¼šè®°å¿†åŒ– DFSï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰

è®°å¿†åŒ– DFS æœ‰ä¸¤ç§çŠ¶æ€å®šä¹‰æ–¹å¼ï¼Œå¯¹åº”â€œæ­£å‘â€å’Œâ€œåå‘â€æ€ç»´ã€‚

### ğŸ” åå‘å®šä¹‰ï¼ˆä»å½“å‰èµ°åˆ°ç»ˆç‚¹ï¼‰
```cpp
// memo[step] = ä» step èµ°åˆ° n çš„æ–¹æ³•æ•°
string dfs(int step, int n, vector<string>& memo) {
    if (step == n) return "1";
    if (step > n) return "0";
    if (memo[step] != "") return memo[step];
    string w1 = dfs(step + 1, n, memo);
    string w2 = dfs(step + 2, n, memo);
    return memo[step] = add_string(w1, w2); // é«˜ç²¾åº¦åŠ æ³•
}
```
- ä¾èµ–â€œæœªæ¥â€çŠ¶æ€ï¼ˆstep+1, step+2ï¼‰
- é€»è¾‘ç›´è§‚ï¼Œä½†ä¸ DP çŠ¶æ€ä¸ä¸€è‡´

### â¡ï¸ æ­£å‘å®šä¹‰ï¼ˆä»èµ·ç‚¹èµ°åˆ°å½“å‰ï¼Œä¸ DP å¯¹é½ï¼‰
```cpp
// memo[i] = ä» 0 èµ°åˆ° i çš„æ–¹æ³•æ•°ï¼ˆç­‰ä»·äº dp[i]ï¼‰
vector<int> dfs(int i, vector<vector<int>>& memo) {
    if (i == 0 || i == 1) return {1};
    if (!memo[i].empty()) return memo[i];
    auto a = dfs(i - 1, memo);
    auto b = dfs(i - 2, memo);
    return memo[i] = add(a, b);
}
```
- ä¾èµ–â€œè¿‡å»â€çŠ¶æ€ï¼ˆi-1, i-2ï¼‰
- **ä¸ DP å®Œå…¨ç­‰ä»·**ï¼Œåªæ˜¯ç”¨é€’å½’å®ç°

### â±ï¸ å¤æ‚åº¦
- æ—¶é—´ï¼š$ O(N \cdot L) $
- ç©ºé—´ï¼š$ O(N \cdot L) + O(N) $ï¼ˆé€’å½’æ ˆï¼‰

---

## âš¡ å››ã€è§£æ³•ä¸‰ï¼šçŸ©é˜µå¿«é€Ÿå¹‚ï¼ˆO(log N)ï¼Ÿï¼‰

### ğŸ“Œ æ ¸å¿ƒæ€æƒ³
å°†é€’æ¨è½¬åŒ–ä¸ºçŸ©é˜µå¹‚ï¼š
$$
\begin{bmatrix} f(n) \\ f(n-1) \end{bmatrix}
=
\begin{bmatrix} 1 & 1 \\ 1 & 0 \end{bmatrix}^{n-1}
\begin{bmatrix} 1 \\ 1 \end{bmatrix}
$$

é€šè¿‡å¿«é€Ÿå¹‚å¯åœ¨ $ O(\log N) $ æ¬¡çŸ©é˜µä¹˜æ³•å†…æ±‚è§£ã€‚

### âœ… é€‚ç”¨åœºæ™¯
- **ç»“æœéœ€å–æ¨¡**ï¼ˆå¦‚ $ \bmod\ 10^9+7 $ï¼‰
- $ N $ æå¤§ï¼ˆå¦‚ $ 10^{18} $ï¼‰

### âŒ ä¸é€‚ç”¨åœºæ™¯
- **å¿…é¡»è¾“å‡ºå®Œæ•´æ•°å­—**ï¼ˆå¦‚æœ¬é¢˜ï¼‰
  - çŸ©é˜µå…ƒç´ æ˜¯å¤§æ•´æ•°ï¼Œä¹˜æ³•å¼€é”€å·¨å¤§ï¼ˆ$ O(L^2) $ï¼‰

---

## ğŸ”‘ äº”ã€Fast Doublingï¼šåˆ†æ²»çš„é­”æ³•

æ—¢ç„¶çŸ©é˜µå¿«é€Ÿå¹‚åœ¨é«˜ç²¾åº¦ä¸‹ä¸åˆ’ç®—ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„ O(log N) æ–¹æ³•ï¼Ÿ

ç­”æ¡ˆæ˜¯ï¼š**Fast Doublingï¼ˆå¿«é€Ÿå€å¢æ³•ï¼‰**ã€‚

### ğŸ§® æ ¸å¿ƒå…¬å¼ï¼ˆæ¨å¯¼è§ä¸‹æ–‡ï¼‰
$$
\begin{aligned}
F_{2k} &= F_k \cdot (2F_{k+1} - F_k) \\
F_{2k+1} &= F_{k+1}^2 + F_k^2
\end{aligned}
$$

å…¶ä¸­ $ F_n $ æ˜¯æ ‡å‡†æ–æ³¢é‚£å¥‘æ•°ï¼ˆ$ F_0=0, F_1=1 $ï¼‰ï¼Œè€Œçˆ¬æ¥¼æ¢¯è§£ä¸º $ f(n) = F_{n+1} $ã€‚

### ğŸ’¡ ä¸ºä»€ä¹ˆé«˜æ•ˆï¼Ÿ
- é€’å½’æ·±åº¦ï¼š$ O(\log n) $
- æ¯å±‚ä»…éœ€å¸¸æ•°æ¬¡å¤§æ•°åŠ /å‡/ä¹˜
- å¯ç»“åˆ FFT ä¹˜æ³•è¿›ä¸€æ­¥åŠ é€Ÿ

> âœ… è¿™æ˜¯ç›®å‰**ç²¾ç¡®è®¡ç®—å¤§æ–æ³¢é‚£å¥‘æ•°çš„æœ€ä¼˜æ–¹æ³•**ã€‚

---

## ğŸ“ å…­ã€Fast Doubling å…¬å¼æ¨å¯¼

æˆ‘ä»¬ä½¿ç”¨æ–æ³¢é‚£å¥‘çš„**åŠ æ³•æ’ç­‰å¼**ï¼š
$$
F_{m+n} = F_{m+1} F_n + F_m F_{n-1} \quad (n \geq 1)
$$

### æ¨å¯¼ $ F_{2k} $
ä»¤ $ m = n = k $ï¼š
$$
F_{2k} = F_{k+1} F_k + F_k F_{k-1} = F_k (F_{k+1} + F_{k-1})
$$
ç”± $ F_{k+1} = F_k + F_{k-1} \Rightarrow F_{k-1} = F_{k+1} - F_k $ï¼Œä»£å…¥å¾—ï¼š
$$
F_{2k} = F_k (2F_{k+1} - F_k)
$$

### æ¨å¯¼ $ F_{2k+1} $
ä»¤ $ m = k+1, n = k $ï¼š
$$
F_{2k+1} = F_{k+2} F_k + F_{k+1} F_{k-1}
$$
ä»£å…¥ $ F_{k+2} = F_{k+1} + F_k $ï¼Œ$ F_{k-1} = F_{k+1} - F_k $ï¼š
$$
\begin{aligned}
F_{2k+1} &= (F_{k+1} + F_k) F_k + F_{k+1} (F_{k+1} - F_k) \\
&= F_{k+1}^2 + F_k^2
\end{aligned}
$$

âœ… ä¸¤ä¸ªå…¬å¼å¾—è¯ï¼

---

## ğŸ“Œ ä¸ƒã€æ€»ç»“ä¸é¢„å‘Š

| æ–¹æ³• | æ—¶é—´å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|------|-----------|--------|
| åŠ¨æ€è§„åˆ’ | $ O(N \cdot L) $ | æœ¬é¢˜ï¼ˆN â‰¤ 5000ï¼‰âœ… |
| è®°å¿†åŒ– DFS | $ O(N \cdot L) $ | é€»è¾‘æ¸…æ™°ï¼Œä½†æœ‰æ ˆé£é™© |
| çŸ©é˜µå¿«é€Ÿå¹‚ | $ O(\log N) $ | **ä»…é€‚ç”¨äºå–æ¨¡** |
| Fast Doubling | $ O(M(L) \log N) $ | **å¤§ N + å®Œæ•´è¾“å‡ºçš„æœ€ä¼˜è§£** |
---