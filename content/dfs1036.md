---
title: ç»„åˆæšä¸¾ DFS ä¸‰å¤§é™·é˜±ï¼šä» pop_back åˆ° vis+for çš„é‡å¤æ·±æ¸Š
date: 2026-01-24
description: æ·±å…¥å‰–æ NOIP é£æ ¼"é€‰æ•°æ±‚ç´ æ•°å’Œ"é—®é¢˜ä¸­ DFS å›æº¯çš„å…¸å‹é”™è¯¯ï¼šå®¹å™¨ä¿®æ”¹é™·é˜±ã€erase é‡å¤è®¡æ•°ã€vis+for æ’åˆ—æ··æ·†ï¼Œå¹¶ç»™å‡ºæ­£ç¡®è§£æ³•ä¸ä¼˜åŒ–æ€è·¯ã€‚
---

# ç»„åˆæšä¸¾ DFS ä¸‰å¤§é™·é˜±ï¼šä» pop_back åˆ° vis+for çš„é‡å¤æ·±æ¸Š

## ğŸ§© é—®é¢˜èƒŒæ™¯

**é¢˜ç›®åŸå‹**ï¼š
NOIP2002 æ™®åŠç»„ã€Œé€‰æ•°ã€(æ´›è°· P1036)

https://www.luogu.com.cn/problem/P1036

ç»™å®š $n$ ä¸ªæ­£æ•´æ•°ï¼Œä»ä¸­ä»»é€‰ $k$ ä¸ªï¼Œé—®æœ‰å¤šå°‘ç§é€‰æ³•ä½¿å¾—å®ƒä»¬çš„å’Œä¸ºç´ æ•°ã€‚

è¿™æ˜¯ä¸€é“ç»å…¸çš„ **ç»„åˆæšä¸¾** é—®é¢˜ã€‚åˆå­¦è€…å¸¸å°è¯•ç”¨ DFS + å›æº¯è§£å†³ï¼Œä½†åœ¨å®ç°æ—¶ææ˜“é™·å…¥ä¸‰å¤§é™·é˜±ï¼š
1. **é”™è¯¯åœ°ä¿®æ”¹è¾“å…¥å®¹å™¨**ï¼ˆå¦‚ `pop_back` / `erase`ï¼‰ï¼›
2. **æœªé™åˆ¶é€‰æ‹©é¡ºåºï¼Œå¯¼è‡´é‡å¤è®¡æ•°ç»„åˆ**ï¼›
3. **è¯¯å°†ç»„åˆå½“ä½œæ’åˆ—å¤„ç†**ã€‚

æœ¬æ–‡å°†é€šè¿‡**å…·ä½“åä¾‹**é€å±‚æ‹†è§£è¿™äº›é”™è¯¯ï¼Œå¹¶ç»™å‡ºå®‰å…¨ã€é«˜æ•ˆçš„æ­£ç¡®å†™æ³•ã€‚

---

## âŒ é™·é˜±ä¸€ï¼šç”¨ `pop_back()` ä¿®æ”¹å®¹å™¨ â€”â€” çŠ¶æ€é”™ä¹±çš„æ ¹æº

### é”™è¯¯ç›´è§‰
> "æˆ‘æŠŠé€‰è¿‡çš„æ•°ä»å®¹å™¨é‡Œåˆ æ‰ï¼Œå‰©ä¸‹çš„å°±æ˜¯å¯é€‰çš„ã€‚"

### é”™è¯¯ä»£ç 
```cpp
int dfs(int lev, vector<int>& chos, int sum) {
    if (lev == 0) return isprime(sum);
    int cnt = 0;
    for (int i = chos.size() - 1; i >= 0; i--) {
        int val = chos[i];     // å–ç¬¬ i ä¸ª
        chos.pop_back();       // å´åˆ æœ€åä¸€ä¸ªï¼
        cnt += dfs(lev - 1, chos, sum + val);
        chos.push_back(val);
    }
    return cnt;
}
```

### ğŸ”¥ åä¾‹è¾“å…¥
```
3 2
10 20 30
```

### âŒ é”™è¯¯è¡Œä¸º
- ç¬¬äºŒè½®å¾ªç¯ï¼š`i = 1`ï¼Œ`val = 20`
- `pop_back()` åˆ é™¤çš„æ˜¯ `30`ï¼ˆæœ€åä¸€ä¸ªï¼‰
- é€’å½’æ—¶ `chos = [10, 20]`ï¼Œä½†åŠ çš„æ˜¯ `val = 20`
- åç»­å¯èƒ½å†æ¬¡é€‰ `20` â†’ å‡ºç°éæ³•ç»„åˆ **(20, 20)**

> ğŸ’¥ **æ ¸å¿ƒé—®é¢˜**ï¼š`val` ä¸è¢«åˆ é™¤çš„å…ƒç´ ä¸ä¸€è‡´ï¼ŒçŠ¶æ€é€»è¾‘å´©åã€‚

---

## âŒ é™·é˜±äºŒï¼šç”¨ `erase` / `insert` å›æº¯ â€”â€” é‡å¤è®¡æ•°çš„æ¸©åºŠ

### é”™è¯¯ç›´è§‰
> "æˆ‘ç”¨ `erase` åˆ æ‰é€‰ä¸­çš„æ•°ï¼Œé€’å½’å®Œå† `insert` æ’å›å»ï¼ŒçŠ¶æ€å®Œç¾æ¢å¤ã€‚"

### é”™è¯¯ä»£ç 
```cpp
for (int i = 0; i < chos.size(); i++) {
    int val = chos[i];
    chos.erase(chos.begin() + i);
    cnt += dfs(lev - 1, chos, sum + val);
    chos.insert(chos.begin() + i, val); // å›æº¯
}
```

### ğŸ”¥ åä¾‹è¾“å…¥
```
2 2
2 3
```

### âŒ é”™è¯¯è¡Œä¸º
- è·¯å¾„1ï¼šå…ˆé€‰ `2` â†’ å†é€‰ `3` â†’ `{2,3}`
- è·¯å¾„2ï¼šå…ˆé€‰ `3` â†’ å†é€‰ `2` â†’ `{3,2}`

â†’ è¢«ç®—ä½œ **2 ç§æ–¹æ¡ˆ**ï¼Œä½†å®é™…åªæœ‰ **1 ä¸ªç»„åˆ**ã€‚  
è¾“å‡º **2** âŒï¼ˆæ­£ç¡®ç­”æ¡ˆåº”ä¸º **1**ï¼‰

> ğŸ“Œ **æ ¹æœ¬åŸå› **ï¼š**ç»„åˆæ˜¯æ— åºçš„ï¼Œä½†æ­¤å†™æ³•ç”Ÿæˆäº†æ‰€æœ‰æ’åˆ—**ã€‚

---

## âŒ é™·é˜±ä¸‰ï¼š`vis` + å…¨å±€ `for` å¾ªç¯ â€”â€” æœ€éšè”½çš„é‡å¤

### é”™è¯¯ç›´è§‰
> "æˆ‘ç”¨ `vis` æ ‡è®°å·²é€‰å…ƒç´ ï¼Œåªé€‰æœªè¢«é€‰çš„ï¼Œè‚¯å®šä¸ä¼šé‡å¤ï¼"

### é”™è¯¯ä»£ç 
```cpp
int dfs(int cnt, int sum) {
    if (cnt == k) return isprime(sum);
    int res = 0;
    for (int i = 0; i < n; i++) {   // â† ä» 0 å¼€å§‹éå†ï¼
        if (!vis[i]) {
            vis[i] = true;
            res += dfs(cnt + 1, sum + a[i]);
            vis[i] = false;
        }
    }
    return res;
}
```

### ğŸ”¥ åä¾‹è¾“å…¥
```
3 2
2 3 5
```

### âŒ é”™è¯¯è¡Œä¸º
åˆæ³•ç´ æ•°ç»„åˆï¼š
- `{2,3}` â†’ 5 âœ…
- `{2,5}` â†’ 7 âœ…

ä½†ç¨‹åºä¼šç”Ÿæˆï¼š
- `(2,3)` å’Œ `(3,2)`
- `(2,5)` å’Œ `(5,2)`

â†’ è¾“å‡º **4** âŒï¼ˆæ­£ç¡®ç­”æ¡ˆä¸º **2**ï¼‰

> ğŸ’¡ **å…³é”®æ•™è®­**ï¼šå³ä½¿æœ‰ `vis`ï¼Œåªè¦ `for` ä» 0 å¼€å§‹ï¼Œå°±ä¼šå›å¤´é€‰å‰é¢çš„å…ƒç´ ï¼Œå¯¼è‡´é‡å¤ã€‚

---

## âœ… æ­£ç¡®è§£æ³•ä¸€ï¼š`for` + èµ·å§‹ä½ç½®æ§åˆ¶ï¼ˆç›´è§‚å®‰å…¨ï¼‰

### æ ¸å¿ƒæ€æƒ³
> **ä¸€æ—¦è·³è¿‡æŸä¸ªå…ƒç´ ï¼Œå°±æ°¸è¿œä¸å†å›å¤´é€‰å®ƒ**ã€‚

### æ­£ç¡®ä»£ç 
```cpp
int dfs(int start, int lev, int sum) {
    if (lev == 0) return isprime(sum);
    int res = 0;
    for (int i = start; i < n; i++) {         // â† ä» start å¼€å§‹ï¼
        res += dfs(i + 1, lev - 1, sum + a[i]); // ä¸‹æ¬¡ä» i+1 å¼€å§‹
    }
    return res;
}
```

### âœ… æ­£ä¾‹éªŒè¯ï¼ˆè¾“å…¥ `2 3`ï¼‰
- `start=0`ï¼šé€‰ `2` â†’ é€’å½’ `start=1` â†’ é€‰ `3` â†’ `{2,3}`
- `start=0`ï¼šé€‰ `3` â†’ é€’å½’ `start=2` â†’ æ— æ³•å†é€‰
- **ä¸ä¼šå‡ºç° `{3,2}`** â†’ è¾“å‡º **1** âœ…

> âœ… æ­¤å†™æ³•å¤©ç„¶é¿å…é‡å¤ï¼Œä¸”æ— éœ€ `vis`ã€‚

---

## ğŸ” ä¸ºä»€ä¹ˆ `vis` æ˜¯å¤šä½™çš„ï¼Ÿ

åœ¨æ­£ç¡®å†™æ³•ä¸­ï¼š
- `start` ä¿è¯æ¯ä¸ªå…ƒç´ åªè¢«è€ƒè™‘ä¸€æ¬¡ï¼›
- `vis[i]` å§‹ç»ˆä¸º `false`ï¼Œæ£€æŸ¥ `if (!vis[i])` æ°¸è¿œæˆç«‹ï¼›
- **`vis` ä¸æä¾›é¢å¤–ä¿¡æ¯ï¼Œåè€Œå¢åŠ ç©ºé—´å’Œå›æº¯å¼€é”€**ã€‚

> ğŸ’¡ ä»…å½“éœ€è¦**è¾“å‡ºå…·ä½“ç»„åˆ**æ—¶ï¼Œ`vis` æ‰æœ‰ä»·å€¼ã€‚

---

## ğŸ” ä¸ºä»€ä¹ˆ `for` ä¹Ÿå¯ä»¥å»æ‰ï¼Ÿâ€”â€”"é€‰/ä¸é€‰"æ¨¡å‹

### æ›´é«˜é˜¶è§†è§’
> **å¯¹æ¯ä¸ªå…ƒç´ ï¼Œç‹¬ç«‹å†³ç­–"é€‰"æˆ–"ä¸é€‰"**ã€‚

### æ­£ç¡®ä»£ç ï¼ˆæ—  `for`ï¼Œæ—  `vis`ï¼‰
```cpp
int dfs(int idx, int cnt, int sum) {
    if (cnt == k) return isprime(sum);
    if (idx >= n) return 0;
    return dfs(idx + 1, cnt + 1, sum + a[idx]) + // é€‰
           dfs(idx + 1, cnt, sum);                // ä¸é€‰
}
```

### âœ… ä¼˜åŠ¿
- ä»£ç æç®€ï¼Œæ— é¢å¤–çŠ¶æ€ï¼›
- é€’å½’æ ‘å¤©ç„¶è¦†ç›–æ‰€æœ‰å­é›†ï¼›
- **åŒæ ·ä¿è¯æ— é‡å¤**ï¼ˆæ¯ä¸ªå…ƒç´ åªå†³ç­–ä¸€æ¬¡ï¼‰ï¼›
- æ—¶é—´å¤æ‚åº¦ $O(2^n)$ï¼Œåœ¨ $n \le 20$ æ—¶å®Œå…¨å¯æ¥å—ã€‚

---

## ğŸ¯ æ€»ç»“ï¼šé¿å‘æŒ‡å—

| é™·é˜± | æ ¹æœ¬åŸå›  | æ­£ç¡®åšæ³• |
|------|--------|--------|
| `pop_back` / `erase` | ä¿®æ”¹è¾“å…¥å®¹å™¨å¯¼è‡´çŠ¶æ€é”™ä¹± | **ä¸è¦ä¿®æ”¹åŸæ•°ç»„ï¼Œç”¨ç´¢å¼•æ§åˆ¶** |
| å…¨å±€ `for` å¾ªç¯ | æœªé™åˆ¶é€‰æ‹©é¡ºåº | **`for` ä» `start` å¼€å§‹ï¼Œä¸‹æ¬¡ `start = i+1`** |
| è¯¯ç”¨ `vis` | ä»¥ä¸ºæ ‡è®°å°±èƒ½é˜²é‡å¤ | **`vis` ä¸èƒ½æ›¿ä»£é¡ºåºæ§åˆ¶** |

> âœ… **ç»ˆæå£è¯€**ï¼š  
> **ç»„åˆæšä¸¾è¦æœ‰åºï¼Œèµ·å§‹ä½ç½®æ§å…¨å±€ï¼›  
> å®¹å™¨ä¿®æ”¹æ˜¯å¤§å¿Œï¼Œé€‰æˆ–ä¸é€‰æœ€ç®€æ´ã€‚**

æŒæ¡è¿™äº›åŸåˆ™ï¼Œä½ å°±èƒ½è½»æ¾é¿å¼€ DFS å›æº¯ä¸­çš„ç»å…¸é™·é˜±ï¼Œå†™å‡ºæ—¢æ­£ç¡®åˆé«˜æ•ˆçš„ç»„åˆæšä¸¾ä»£ç ï¼