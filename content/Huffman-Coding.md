---
title: åˆå¹¶æœå­çš„æœ€ä¼˜è§£æ³•ï¼šä»å“ˆå¤«æ›¼è´ªå¿ƒåˆ° O(n) æ¡¶æ’åŒé˜Ÿåˆ—ä¼˜åŒ–
date: 2026-02-08
description: å…¨é¢å‰–æâ€œåˆå¹¶æœå­â€é—®é¢˜çš„ä¸‰ç§å®ç°è·¯å¾„ï¼šé”™è¯¯çš„çº¿æ€§è´ªå¿ƒã€æ­£ç¡®çš„ä¼˜å…ˆé˜Ÿåˆ—è§£æ³•ï¼Œä»¥åŠåˆ©ç”¨å€¼åŸŸé™åˆ¶å®ç°çš„ O(n) æ¡¶æ’åº + åŒé˜Ÿåˆ—ä¼˜åŒ–ã€‚æ·±å…¥è®²è§£ä¸ºä½• Subtask 4ï¼ˆn=1e7ï¼‰å¿…é¡»æ”¾å¼ƒå †ç»“æ„ï¼Œå¹¶å±•ç¤ºå¦‚ä½•é€šè¿‡ç®—æ³•æ´å¯Ÿä¸å¸¸æ•°ä¼˜åŒ–ç¨³ç¨³ AC æ‰€æœ‰æµ‹è¯•ç‚¹ã€‚
---
# åˆå¹¶æœå­ï¼šä»é”™è¯¯è´ªå¿ƒåˆ° O(n) æ¡¶æ’åŒé˜Ÿåˆ—ä¼˜åŒ–

> **é¢˜ç›®ç®€è¿°**ï¼šæœ‰ $n$ å †æœå­ï¼Œæ¯æ¬¡åˆå¹¶ä¸¤å †ï¼Œæ¶ˆè€—ä½“åŠ›ä¸ºä¸¤å †é‡é‡ä¹‹å’Œã€‚æ±‚åˆå¹¶æˆä¸€å †çš„æœ€å°æ€»ä½“åŠ›æ¶ˆè€—ã€‚

è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„ **å“ˆå¤«æ›¼ç¼–ç ï¼ˆHuffman Codingï¼‰** é—®é¢˜ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ **æ¯æ¬¡åˆå¹¶å½“å‰æœ€å°çš„ä¸¤å †**ã€‚ä½†å¦‚ä½•é«˜æ•ˆå®ç°ï¼Œå†³å®šäº†ä½ èƒ½å¦é€šè¿‡æ‰€æœ‰æµ‹è¯•ç‚¹ï¼ˆå°¤å…¶æ˜¯ $n = 10^7$ çš„ Subtask 4ï¼‰ã€‚

---

https://www.luogu.com.cn/problem/P6033

## âŒ é”™è¯¯å†™æ³•ä¸€ï¼šçº¿æ€§è´ªå¿ƒï¼ˆå®Œå…¨é”™è¯¯ï¼‰

```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;
int main() {
    int n; cin >> n;
    vector<int> w;
    for (int i = 1; i <= n; i++) {
        int var; cin >> var;
        w.push_back(var);
    }
    if (n == 1) sum = w[0];
    else sum = w[0] + w[1];
    sort(w.begin(), w.end());
    for (int i = 2; i < w.size(); i++) {
        int varsum = sum + w[i];
        sum = sum + varsum;
    }
    cout << sum;
}
```

### ğŸ” é—®é¢˜åˆ†æï¼š
- **ç®—æ³•é€»è¾‘é”™è¯¯**ï¼šè®¤ä¸ºâ€œå…ˆåˆå¹¶å‰ä¸¤ä¸ªï¼Œå†ä¾æ¬¡åˆå¹¶â€æ˜¯æœ€ä¼˜çš„ã€‚
- **åä¾‹**ï¼š`[1, 1, 1, 1, 100]`ï¼š
    - æ­£ç¡®åšæ³•ï¼šåˆå¹¶å››ä¸ª 1 â†’ æ€»æ¶ˆè€— = 1+1=2, 1+1=2, 2+2=4, 4+100=104 â†’ total=2+2+4+104=112
    - è¯¥ä»£ç ï¼šæ’åºå `[1,1,1,1,100]`ï¼Œ`sum = 1+1=2`ï¼Œç„¶å `2+1=3`ï¼ˆsum=5ï¼‰ï¼Œ`5+1=6`ï¼ˆsum=11ï¼‰ï¼Œ`11+100=111`ï¼ˆsum=122ï¼‰â†’ **é”™è¯¯ï¼**

> âœ… **ç»“è®º**ï¼šå“ˆå¤«æ›¼æ ‘å¿…é¡»**åŠ¨æ€ç»´æŠ¤æœ€å°å€¼**ï¼Œä¸èƒ½ç®€å•æŒ‰æ’åºé¡ºåºåˆå¹¶ï¼

---

## âš ï¸ å†™æ³•äºŒï¼šä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæ­£ç¡®ä½†è¶…æ—¶ï¼‰

```cpp
#include <iostream>
#include <queue>
#include <vector>
using namespace std;
int main() {
    int n; cin >> n;
    priority_queue<long long, vector<long long>, greater<long long>> w;
    long long sum = 0;
    for (int i = 1; i <= n; i++) {
        int var; cin >> var;
        w.push(var);
    }
    while (w.size() != 1) {
        long long a = w.top(); w.pop();
        long long b = w.top(); w.pop();
        long long c = a + b;
        w.push(c);
        sum += c;
    }
    cout << sum;
}
```

### âœ… ä¼˜ç‚¹ï¼š
- **ç®—æ³•æ­£ç¡®**ï¼šæ¯æ¬¡å–æœ€å°ä¸¤å †ï¼Œç¬¦åˆå“ˆå¤«æ›¼è´ªå¿ƒã€‚
- **å¤„ç†äº† `long long` æº¢å‡ºé—®é¢˜**ã€‚

### âŒ ä¸ºä»€ä¹ˆ Subtask 4ï¼ˆn=1e7ï¼‰è¶…æ—¶ï¼Ÿ
1. **æ—¶é—´å¤æ‚åº¦é«˜**ï¼š  
   æ¯æ¬¡ `push/pop` æ˜¯ $O(\log n)$ï¼Œå…± $n-1$ æ¬¡ â†’ **æ€»æ—¶é—´ $O(n \log n)$**ã€‚  
   å½“ $n = 10^7$ æ—¶ï¼Œæ“ä½œæ¬¡æ•° â‰ˆ $10^7 \times \log_2(10^7) \approx 2.4 \times 10^8$ï¼Œå¸¸æ•°å¤§ï¼Œææ˜“ TLEã€‚

2. **è¾“å…¥å¤ªæ…¢**ï¼š  
   `cin` å³ä½¿å…³é—­åŒæ­¥ï¼Œåœ¨ $10^7$ æ•°æ®ä¸‹ä»æ¯” `scanf`/å¿«è¯»æ…¢ã€‚

3. **å †çš„å¸¸æ•°å¤§**ï¼š  
   `priority_queue` åŸºäºäºŒå‰å †ï¼Œå†…å­˜è·³è½¬å¤šï¼Œç¼“å­˜ä¸å‹å¥½ã€‚

> âœ… **é€‚ç”¨åœºæ™¯**ï¼š$n \leq 10^5$ï¼ˆSubtask 1~3 å¯è¿‡ï¼ŒSubtask 4 å¿… TLEï¼‰

---

## âœ… ç»ˆæä¼˜åŒ–ï¼šæ¡¶æ’åº + åŒé˜Ÿåˆ—ï¼ˆO(n) è§£æ³•ï¼‰

### ğŸ§  æ ¸å¿ƒæ´å¯Ÿ
é¢˜ç›®ç»™å‡ºå…³é”®çº¦æŸï¼š**æ¯å †æœå­é‡é‡ $1 \leq a_i \leq 10^5$**ã€‚  
è¿™æ„å‘³ç€ï¼š
- å€¼åŸŸå¾ˆå°ï¼ˆä»… 10âµ ç§å¯èƒ½å€¼ï¼‰
- å¯ç”¨ **æ¡¶æ’åºï¼ˆè®¡æ•°æ’åºï¼‰** åœ¨ $O(n + 10^5)$ æ—¶é—´å†…å¾—åˆ°**å‡åºåºåˆ—**
- åˆå¹¶è¿‡ç¨‹ä¸­ï¼Œæ–°ç”Ÿæˆçš„å †é‡é‡**å•è°ƒä¸å‡** â†’ å¯ç”¨**åŒé˜Ÿåˆ—**ç»´æŠ¤

### ğŸ”‘ åŒé˜Ÿåˆ—åŸç†
- **`q1`**ï¼šåˆå§‹æœå­å †ï¼ˆæ¡¶æ’åå‡åºï¼‰
- **`q2`**ï¼šåˆå¹¶äº§ç”Ÿçš„æ–°å †ï¼ˆæŒ‰ç”Ÿæˆé¡ºåºï¼Œå¤©ç„¶å•è°ƒä¸å‡ï¼‰
- æ¯æ¬¡ä» `q1.front()` å’Œ `q2.front()` ä¸­é€‰æœ€å°è€…ï¼Œ**O(1) å–æœ€å°å€¼**

> ğŸ’¡ åˆå¹¶è¿‡ç¨‹å˜ä¸ºçº¯çº¿æ€§ $O(n)$ï¼Œæ€»å¤æ‚åº¦ç”±æ’åºä¸»å¯¼ â†’ ä½†æ¡¶æ’æ˜¯ $O(n)$ï¼

---

### ğŸš€ æœ€ç»ˆ AC ä»£ç 

```cpp
#include <cstdio>
#include <queue>
using namespace std;

const int MAX_A = 100000;
int cnt[MAX_A + 5];

// ç®€å•å¿«è¯»ï¼ˆåªè¯»æ­£æ•´æ•°ï¼‰
inline int read() {
    int x = 0;
    char c = getchar();
    while (c < '0' || c > '9') c = getchar();
    while (c >= '0' && c <= '9') {
        x = x * 10 + (c - '0');
        c = getchar();
    }
    return x;
}

int main() {
    int n = read();
    
    // æ¡¶è®¡æ•°ï¼šO(n)
    for (int i = 0; i < n; ++i) {
        int a = read();
        cnt[a]++;
    }

    if (n == 1) {
        puts("0");
        return 0;
    }

    // æ„å»º q1ï¼šæŒ‰é‡é‡å‡åº
    queue<long long> q1, q2;
    for (int w = 1; w <= MAX_A; ++w) {
        while (cnt[w]--) {
            q1.push(w);
        }
    }

    long long ans = 0;
    for (int i = 0; i < n - 1; ++i) {
        long long x, y;

        // å®‰å…¨å–æœ€å°å€¼ï¼ˆå…ˆåˆ¤ç©ºï¼ï¼‰
        if (q2.empty() || (!q1.empty() && q1.front() <= q2.front())) {
            x = q1.front(); q1.pop();
        } else {
            x = q2.front(); q2.pop();
        }

        if (q2.empty() || (!q1.empty() && q1.front() <= q2.front())) {
            y = q1.front(); q1.pop();
        } else {
            y = q2.front(); q2.pop();
        }

        long long s = x + y;
        ans += s;
        q2.push(s); // q2 ä¿æŒå•è°ƒä¸å‡
    }

    printf("%lld\n", ans);
    return 0;
}
```

---

### âœ… ä¸ºä»€ä¹ˆæ›´å¿«ï¼Ÿ

| ä¼˜åŒ–ç‚¹ | æ•ˆæœ |
|-------|------|
| **æ¡¶æ’åº** | æ›¿ä»£ `sort`ï¼Œ$O(n)$ ç”Ÿæˆæœ‰åºåºåˆ— |
| **åŒé˜Ÿåˆ—** | åˆå¹¶è¿‡ç¨‹ $O(1)$ å–æœ€å°å€¼ï¼Œæ€»åˆå¹¶ $O(n)$ |
| **å¿«è¯»** | è¾“å…¥ $10^7$ æ•°æ®ä»…éœ€ ~200ms |
| **å®‰å…¨åˆ¤ç©º** | é¿å… `front()` on empty queue çš„ UB |

---

## ğŸ’¡ æ€»ç»“

> **å…³é”®æ•™è®­**ï¼š
> 1. å“ˆå¤«æ›¼æ ‘å¿…é¡»åŠ¨æ€ç»´æŠ¤æœ€å°å€¼ï¼›
> 2. åˆ©ç”¨é¢˜ç›®çº¦æŸï¼ˆå€¼åŸŸå°ï¼‰å¯çªç ´ $O(n \log n)$ï¼›
> 3. **å¿«è¯» + å®‰å…¨åˆ¤ç©º + long long** æ˜¯å¤§æ•°æ®é¢˜çš„æ ‡é…ã€‚