---
title: 01 èƒŒåŒ… + æ’åˆ—å‹ä¸ºä½•ä¸èƒ½ç”¨ DPï¼Ÿâ€”â€”ä»çŠ¶æ€è®¾è®¡æœ¬è´¨åˆ° Meet-in-the-Middle è§£æ³•
date: 2026-02-04
description: æ·±å…¥å‰–æâ€œ01 èƒŒåŒ… + æ’åˆ—å‹â€é—®é¢˜ä¸ºä½•æ— æ³•ç”¨æ ‡å‡†åŠ¨æ€è§„åˆ’æ±‚è§£ï¼Œæ­ç¤ºå…¶ç»„åˆæ•°å­¦æœ¬è´¨ï¼Œå¹¶ç»™å‡ºæš´åŠ›æšä¸¾ä¸æŠ˜åŠæœç´¢ä¸¤ç§é«˜æ•ˆå®ç°æ–¹æ¡ˆã€‚
---
# 01 èƒŒåŒ… + æ’åˆ—å‹ï¼šæŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

> **å…³é”®è¯**ï¼šåŠ¨æ€è§„åˆ’ã€èƒŒåŒ…é—®é¢˜ã€æ’åˆ—å‹è®¡æ•°ã€DFSã€Meet-in-the-Middleã€çŠ¶æ€å‹ç¼©

---

## å¼•è¨€

åœ¨èƒŒåŒ…é—®é¢˜çš„å¤§å®¶åº­ä¸­ï¼Œ01 èƒŒåŒ…ï¼ˆæ¯ç§ç‰©å“æœ€å¤šé€‰ä¸€æ¬¡ï¼‰æ˜¯æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€å¸¸è§çš„ã€‚è€Œå½“æˆ‘ä»¬è¿›ä¸€æ­¥è¦æ±‚**ä¸åŒé€‰æ‹©é¡ºåºè§†ä¸ºä¸åŒæ–¹æ¡ˆ**æ—¶ï¼Œé—®é¢˜å˜å¾—å¤æ‚èµ·æ¥â€”â€”è¿™å°±æ˜¯æ‰€è°“çš„â€œ01 èƒŒåŒ… + æ’åˆ—å‹â€ã€‚æœ¬æ–‡å°†æ¢è®¨ï¼š
- ä¸ºä»€ä¹ˆæ ‡å‡† DP éš¾ä»¥å¤„ç†è¿™ç§æ¨¡å‹ï¼Ÿ
- å¯è¡Œçš„è§£å†³æ–¹æ¡ˆåŠå…¶é€‚ç”¨åœºæ™¯ã€‚
- å¦‚ä½•å®ç°è¿™äº›è§£å†³æ–¹æ¡ˆï¼Œå¹¶åˆ†æå…¶ä¼˜ç¼ºç‚¹ã€‚

---

## ä¸€ã€é—®é¢˜æè¿°

### âœ… å®šä¹‰
- ç»™å®š N ä¸ªäº’å¼‚ç‰©å“ï¼ˆå³ä½¿ä»·æ ¼ç›¸åŒï¼Œä¹Ÿè§†ä¸ºä¸åŒï¼‰
- æ¯ä¸ªç‰©å“åªèƒ½é€‰ **0 æˆ– 1 æ¬¡**
- æ±‚æ‰€æœ‰æœ‰åºé€‰æ‹©åºåˆ—ï¼ˆå³æ’åˆ—ï¼‰ï¼Œä½¿å¾—å…¶æ€»å’Œæ°å¥½ä¸º M
- è¾“å‡ºè¿™æ ·çš„åºåˆ—æ€»æ•°

### ğŸ“Œ ç¤ºä¾‹
å‡è®¾ `a = [1, 2]`, M = 3  
åˆæ³•æ–¹æ¡ˆï¼š
- å…ˆé€‰ 1 å†é€‰ 2 â†’ `[1, 2]`
- å…ˆé€‰ 2 å†é€‰ 1 â†’ `[2, 1]`

ç­”æ¡ˆä¸º **2**ï¼ˆå› ä¸ºé¡ºåºä¸åŒï¼‰

---

## äºŒã€ä¸ºä»€ä¹ˆæ ‡å‡† DP éš¾ä»¥å®ç°ï¼Ÿ

### âŒ æ ¸å¿ƒéš¾ç‚¹ï¼šæ— æ³•åŒæ—¶è®°å½•â€œç”¨äº†å“ªäº›ç‰©å“â€å’Œâ€œå½“å‰é‡‘é¢â€

#### 1. **ä¸€ç»´ DP ä¸¢å¤±ç‰©å“ä½¿ç”¨ä¿¡æ¯**
```cpp
dp[j] += dp[j - a[i]];
```
- `dp[j]` è¡¨ç¤ºå‡‘å‡ºé‡‘é¢ j çš„æ–¹æ¡ˆæ•°
- ä½†ä¸çŸ¥é“å…·ä½“ç”¨äº†å“ªäº›ç‰©å“ï¼Œå› æ­¤æ— æ³•åŒºåˆ†ä¸åŒé¡ºåº

#### 2. **äºŒç»´ DP å¤©ç„¶ç»„åˆå‹**
```cpp
dp[i][j] = dp[i-1][j] + dp[i-1][j - a[i]];
```
- è¿™ç§å®šä¹‰éšå«äº†â€œæŒ‰ç‰©å“ç¼–å·é¡ºåºå†³ç­–â€
- æ‰€æœ‰æ–¹æ¡ˆéƒ½æŒ‰ `ç‰©å“0 â†’ ç‰©å“1 â†’ ...` æ„å»º â†’ è‡ªç„¶å»é‡é¡ºåº

#### 3. **è¦åŒºåˆ†é¡ºåºï¼Œå¿…é¡»è®°å½•â€œé€‰æ‹©åºåˆ—â€**
- ä½†åºåˆ—ä¿¡æ¯æ— æ³•å‹ç¼©è¿› `dp[amount]` æˆ– `dp[i][j]`
- è‹¥ç”¨ `dp[mask][j]`ï¼ˆmask è¡¨ç¤ºå·²é€‰ç‰©å“é›†åˆï¼‰ï¼Œè™½ç„¶å¯è¡Œï¼Œä½†ï¼š
  - æ—¶é—´å¤æ‚åº¦ O(2^N Ã— M)ï¼ŒN â‰¤ 100 æ—¶ä¸å¯è¡Œ
  - ä¸”ä»éœ€é¢å¤–å¤„ç†â€œé¡ºåºâ€â€”â€”å› ä¸º mask æœ¬èº«æ˜¯æ— åºé›†åˆï¼

> ğŸ’¡ **ç»“è®º**ï¼š  
> **æ ‡å‡†èƒŒåŒ… DP çš„çŠ¶æ€è®¾è®¡åŸºäºâ€œé›†åˆâ€è€Œéâ€œåºåˆ—â€ï¼Œå¤©ç„¶é€‚åˆç»„åˆå‹é—®é¢˜ã€‚ä¸€æ—¦è¦æ±‚é¡ºåºæ•æ„Ÿï¼ŒDP çŠ¶æ€éš¾ä»¥é«˜æ•ˆè¡¨è¾¾ã€‚**

---

## ä¸‰ã€å¯è¡Œçš„è§£å†³æ–¹æ¡ˆ

### âœ… æ–¹æ¡ˆä¸€ï¼š**æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰+ å›æº¯** â€”â€” å°æ•°æ®é›†

#### æ€è·¯
- ç»´æŠ¤å½“å‰æ€»é‡‘é¢ `sum`
- ç»´æŠ¤ä¸€ä¸ª `used[]` æ•°ç»„ï¼Œè®°å½•å“ªäº›ç‰©å“å·²è¢«é€‰
- æ¯æ¬¡ä»æ‰€æœ‰æœªä½¿ç”¨çš„ç‰©å“ä¸­ä»»é€‰ä¸€ä¸ªä½œä¸ºâ€œä¸‹ä¸€æ­¥â€
- è‹¥ `sum == M`ï¼Œåˆ™æ‰¾åˆ°ä¸€ç§æœ‰æ•ˆæ’åˆ—ï¼Œ`ans++`
- è‹¥ `sum > M`ï¼Œå‰ªæ

#### å®ç°ï¼ˆC++ï¼‰
```cpp
#include <iostream>
#include <vector>
using namespace std;

int n, M, ans = 0;
vector<int> a;
vector<bool> used;

void dfs(int sum) {
    if (sum == M) {
        ans++;
        return;
    }
    if (sum > M) return;

    for (int i = 0; i < n; i++) {
        if (!used[i]) {
            used[i] = true;
            dfs(sum + a[i]);
            used[i] = false; // å›æº¯
        }
    }
}

int main() {
    cin >> n >> M;
    a.resize(n);
    used.assign(n, false);
    for (int i = 0; i < n; i++) {
        cin >> a[i];
    }
    dfs(0);
    cout << ans << endl;
    return 0;
}
```

#### ä¼˜ç‚¹
- é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£
- ç›´æ¥æšä¸¾æ‰€æœ‰å¯èƒ½è·¯å¾„

#### ç¼ºç‚¹
- æ—¶é—´å¤æ‚åº¦é«˜ï¼šæœ€å O(N!)
- ä»…é€‚ç”¨äºå°æ•°æ®é›†ï¼ˆå¦‚ N â‰¤ 15ï¼‰

---

## ğŸ§  é—®é¢˜å›é¡¾

> ç»™å®š N ä¸ªç‰©å“ï¼ˆæ¯ä¸ªåªèƒ½é€‰ä¸€æ¬¡ï¼‰ï¼Œä»·æ ¼ä¸º `a[0..N-1]`ï¼Œæ±‚æ‰€æœ‰**æœ‰åºé€‰æ‹©åºåˆ—**ï¼ˆå³æ’åˆ—ï¼‰ï¼Œä½¿å¾—æ€»å’Œæ°å¥½ä¸º Mã€‚  
> è¾“å‡ºè¿™æ ·çš„åºåˆ—æ€»æ•°ã€‚

ç­‰ä»·äºï¼š
$$
\text{ç­”æ¡ˆ} = \sum_{\substack{S \subseteq \{0,\dots,N-1\} \\ \sum_{i\in S} a_i = M}} |S|!
$$

å³ï¼šå¯¹æ¯ä¸€ä¸ªå’Œä¸º M çš„å­é›† Sï¼Œè´¡çŒ® `|S|!` ç§æ’åˆ—(è¯´äººè¯ç‰ˆ)ã€‚

---

### âœ… æ–¹æ¡ˆäºŒï¼šæš´åŠ›æšä¸¾å­é›† + é˜¶ä¹˜ï¼ˆé€‚ç”¨äº N â‰¤ 20ï¼‰

## ğŸ” ç®—æ³•åŸç†

1. **æšä¸¾æ‰€æœ‰å­é›†**ï¼šç”¨ä½æ©ç  `mask âˆˆ [0, 2^N)` è¡¨ç¤ºä¸€ä¸ªå­é›†ã€‚
   - è‹¥ `mask` çš„ç¬¬ i ä½ä¸º 1ï¼Œåˆ™è¡¨ç¤ºé€‰æ‹©äº†ç¬¬ i ä¸ªç‰©å“ã€‚

2. **å¯¹æ¯ä¸ªå­é›†**ï¼š
   - è®¡ç®—å…¶å…ƒç´ ä¹‹å’Œ `sum`
   - è®¡ç®—å…¶å¤§å° `cnt`ï¼ˆå³ 1 çš„ä¸ªæ•°ï¼‰
   - å¦‚æœ `sum == M`ï¼Œåˆ™è¯¥å­é›†å¯¹åº” `cnt!` ç§æ’åˆ—ï¼ˆå› ä¸ºé¡ºåºä¸åŒç®—ä¸åŒæ–¹æ¡ˆï¼‰

3. **é¢„è®¡ç®—é˜¶ä¹˜**ï¼šé¿å…é‡å¤è®¡ç®— `k!`

4. **ç´¯åŠ æ‰€æœ‰åˆæ³•å­é›†çš„ `cnt!`**

> æ—¶é—´å¤æ‚åº¦ï¼šO(N Ã— 2^N)  
> ç©ºé—´å¤æ‚åº¦ï¼šO(1)

å¯¹äº N = 20ï¼Œ2^20 â‰ˆ 1e6ï¼Œå®Œå…¨å¯åœ¨ 1 ç§’å†…å®Œæˆã€‚

---

## ğŸ’» C++ ä»£ç ï¼ˆæ–¹æ¡ˆäºŒï¼‰

```cpp
#include <iostream>
#include <vector>
using namespace std;

int main() {
    int N, M;
    cin >> N >> M;
    vector<int> a(N);
    for (int i = 0; i < N; ++i) {
        cin >> a[i];
    }

    // é¢„è®¡ç®—é˜¶ä¹˜ fact[k] = k!
    vector<long long> fact(N + 1);
    fact[0] = 1;
    for (int i = 1; i <= N; ++i) {
        fact[i] = fact[i - 1] * i;
    }

    long long ans = 0;
    int totalMasks = 1 << N; // 2^N

    for (int mask = 0; mask < totalMasks; ++mask) {
        int sum = 0;
        int cnt = 0;
        for (int i = 0; i < N; ++i) {
            if (mask & (1 << i)) {
                sum += a[i];
                cnt++;
            }
        }
        if (sum == M) {
            ans += fact[cnt];
        }
    }

    cout << ans << endl;
    return 0;
}
```

### âœ… æ–¹æ¡ˆä¸‰ï¼šMeet-in-the-Middleï¼ˆæŠ˜åŠæœç´¢ï¼Œé€‚ç”¨äº N â‰¤ 40ï¼‰

## ğŸ” ç®—æ³•åŸç†

å½“ N è¾ƒå¤§ï¼ˆå¦‚ 30~40ï¼‰æ—¶ï¼Œ2^N å¤ªå¤§ï¼ˆ2^40 â‰ˆ 1e12ï¼‰ï¼Œæš´åŠ›ä¸å¯è¡Œã€‚  
**Meet-in-the-Middleï¼ˆMITMï¼‰** å°†é—®é¢˜æ‹†æˆä¸¤åŠï¼Œé™ä½æŒ‡æ•°çº§å¤æ‚åº¦ã€‚

### æ­¥éª¤è¯¦è§£ï¼š

1. **åˆ†å‰²ç‰©å“**ï¼š
   - å‰åŠéƒ¨åˆ† Aï¼š`a[0 .. mid-1]`
   - ååŠéƒ¨åˆ† Bï¼š`a[mid .. N-1]`
   - å…¶ä¸­ `mid = N / 2`

2. **æšä¸¾ A çš„æ‰€æœ‰å­é›†**ï¼š
   - å¯¹æ¯ä¸ªå­é›†ï¼Œè®°å½• `(sumA, sizeA)`
   - å­˜å…¥å“ˆå¸Œè¡¨ï¼š`mapA[sumA]` æ˜¯ä¸€ä¸ª `vector<int>`ï¼Œä¿å­˜æ‰€æœ‰å¯èƒ½çš„ `sizeA`

3. **æšä¸¾ B çš„æ‰€æœ‰å­é›†**ï¼š
   - å¯¹æ¯ä¸ªå­é›†ï¼Œå¾—åˆ° `(sumB, sizeB)`
   - éœ€è¦æ‰¾ A ä¸­æ»¡è¶³ `sumA = M - sumB` çš„å­é›†
   - å¯¹æ¯ä¸ªå¯¹åº”çš„ `sizeA`ï¼Œç»„åˆåçš„æ€»å¤§å°ä¸º `k = sizeA + sizeB`
   - è´¡çŒ®ä¸º `k!`ï¼ˆå› ä¸ºæ•´ä¸ªé›†åˆæœ‰ k ä¸ªå…ƒç´ ï¼Œå…¨æ’åˆ—ï¼‰

4. **ç´¯åŠ æ‰€æœ‰è´¡çŒ®**

> æ—¶é—´å¤æ‚åº¦ï¼šO(N Ã— 2^{N/2})  
> ç©ºé—´å¤æ‚åº¦ï¼šO(2^{N/2})

å¯¹äº N = 40ï¼Œ2^{20} â‰ˆ 1e6ï¼Œéå¸¸å¯è¡Œï¼

---

## ğŸ’» C++ ä»£ç ï¼ˆæ–¹æ¡ˆä¸‰ï¼‰

```cpp
#include <iostream>
#include <vector>
#include <unordered_map>
using namespace std;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    int N, M;
    cin >> N >> M;
    vector<int> a(N);
    for (int i = 0; i < N; ++i) {
        cin >> a[i];
    }

    // é¢„è®¡ç®—é˜¶ä¹˜ï¼Œæœ€å¤§å¯èƒ½å¤§å°æ˜¯ N
    vector<long long> fact(N + 1);
    fact[0] = 1;
    for (int i = 1; i <= N; ++i) {
        fact[i] = fact[i - 1] * i;
    }

    int mid = N / 2;
    int n1 = mid;
    int n2 = N - mid;

    // ç¬¬ä¸€éƒ¨åˆ†ï¼ša[0 .. mid-1]
    vector<int> A(a.begin(), a.begin() + n1);
    // ç¬¬äºŒéƒ¨åˆ†ï¼ša[mid .. end]
    vector<int> B(a.begin() + n1, a.end());

    // mapA[sum] = æ‰€æœ‰å­é›†å¤§å°ï¼ˆsizeï¼‰çš„åˆ—è¡¨
    unordered_map<int, vector<int>> mapA;

    // æšä¸¾ A çš„æ‰€æœ‰å­é›†
    for (int mask = 0; mask < (1 << n1); ++mask) {
        int sum = 0, cnt = 0;
        for (int i = 0; i < n1; ++i) {
            if (mask & (1 << i)) {
                sum += A[i];
                cnt++;
            }
        }
        if (sum <= M) {
            mapA[sum].push_back(cnt);
        }
    }

    long long ans = 0;

    // æšä¸¾ B çš„æ‰€æœ‰å­é›†
    for (int mask = 0; mask < (1 << n2); ++mask) {
        int sumB = 0, cntB = 0;
        for (int i = 0; i < n2; ++i) {
            if (mask & (1 << i)) {
                sumB += B[i];
                cntB++;
            }
        }
        if (sumB > M) continue;

        int need = M - sumB;
        if (mapA.find(need) != mapA.end()) {
            for (int cntA : mapA[need]) {
                int totalSize = cntA + cntB;
                ans += fact[totalSize];
            }
        }
    }

    cout << ans << '\n';
    return 0;
}
```

## ğŸ§© ä¸ºä»€ä¹ˆè¿™ä¸¤ç§æ–¹æ³•èƒ½è§£å†³â€œæ’åˆ—å‹â€ï¼Ÿ

å…³é”®åœ¨äºï¼š**æˆ‘ä»¬ä¸æ˜¯ç›´æ¥è®¡æ•°æ’åˆ—ï¼Œè€Œæ˜¯å…ˆæ‰¾å‡ºæ‰€æœ‰åˆæ³•å­é›†ï¼Œå†ä¹˜ä»¥å…¶å…¨æ’åˆ—æ•° `k!`**ã€‚

- å­é›†æšä¸¾ â†’ ä¿è¯æ¯ä¸ªç‰©å“æœ€å¤šç”¨ä¸€æ¬¡ï¼ˆ01 çº¦æŸï¼‰
- ä¹˜ä»¥ `k!` â†’ å°†æ¯ä¸ªå­é›†æ‰©å±•ä¸ºæ‰€æœ‰å¯èƒ½çš„é¡ºåºï¼ˆæ’åˆ—å‹ï¼‰

è¿™ç»•è¿‡äº† DP æ— æ³•è®°å½•é¡ºåºçš„ç¼ºé™·ï¼Œç”¨**ç»„åˆæ•°å­¦ + æšä¸¾**å·§å¦™è§£å†³é—®é¢˜ã€‚

---